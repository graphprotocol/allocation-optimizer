<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API Reference Â· The Allocation Optimizer</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://graphprotocol.github.io/allocation-optimizer/api/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">The Allocation Optimizer</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../configuration/">Configuration</a></li><li><span class="tocitem">Usage</span><ul><li><a class="tocitem" href="../provided-binary/">Using The Provided Binary</a></li><li><a class="tocitem" href="../build-a-binary/">Build Your Own Binary</a></li><li><a class="tocitem" href="../call-julia/">Calling From Julia</a></li><li><a class="tocitem" href="../calling-another/">Calling From Another Language</a></li></ul></li><li><a class="tocitem" href="../output/">Understanding The Output</a></li><li class="is-active"><a class="tocitem" href>API Reference</a></li><li><a class="tocitem" href="../bugs/">Reporting Bugs</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API Reference</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/graphprotocol/allocation-optimizer/blob/main/docs/src/api.md#" title="Edit on GitHub"><span class="docs-icon fab">ï‚›</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.AnalyticOpt" href="#AllocationOpt.AnalyticOpt"><code>AllocationOpt.AnalyticOpt</code></a> â€” <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AnalyticOpt{
    T&lt;:Real,
    V&lt;:AbstractArray{T},
    U&lt;:AbstractArray{T},
    A&lt;:AbstractArray{T},
    S&lt;:AbstractVector{&lt;:Hook},
} &lt;: SemioticOpt.OptAlgorithm</code></pre><p>Optimise the indexing reward analytically.</p><p><strong>Fields</strong></p><ul><li><code>x::V</code> is the current best guess for the solution. Typically zeros.</li><li><code>Î©::U</code> is the allocation vector of other indexers.</li><li><code>Ïˆ::A</code> is the signal vector.</li><li><code>Ïƒ::T</code> is the stake.</li><li><code>hooks::S</code> are the hooks</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using SemioticOpt
julia&gt; x = zeros(2)
julia&gt; Î© = [1.0, 1.0]
julia&gt; Ïˆ = [10.0, 10.0]
julia&gt; Ïƒ = 5.0
julia&gt; alg = AllocationOpt.AnalyticOpt(;
           x=x, Î©=Î©, Ïˆ=Ïˆ, Ïƒ=Ïƒ, hooks=[StopWhen((a; kws...) -&gt; kws[:i] &gt; 1)]
       )
julia&gt; f = x -&gt; x  # This doesn&#39;t matter. `f` isn&#39;t used by the algorithm.
julia&gt; alg = minimize!(f, alg)
julia&gt; SemioticOpt.x(alg)
2-element Vector{Float64}:
 2.5
 2.5</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L4-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.allocatablesubgraphs-Tuple{TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.allocatablesubgraphs-Tuple{TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.allocatablesubgraphs</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs"> allocatablesubgraphs(s::FlexTable, config::AbstractDict)</code></pre><p>For the subgraphs <code>s</code> return a view of the subgraphs on which we can allocate.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; s = flextable([
            Dict(&quot;ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;signalledTokens&quot; =&gt; 10,),
            Dict(&quot;ipfsHash&quot; =&gt; &quot;Qmb&quot;, &quot;signalledTokens&quot; =&gt; 20),
            Dict(&quot;ipfsHash&quot; =&gt; &quot;Qmc&quot;, &quot;signalledTokens&quot; =&gt; 5),
       ])
julia&gt; config = Dict(
            &quot;whitelist&quot; =&gt; String[&quot;Qmb&quot;, &quot;Qmc&quot;],
            &quot;blacklist&quot; =&gt; String[],
            &quot;frozenlist&quot; =&gt; String[],
            &quot;pinnedlist&quot; =&gt; String[],
            &quot;min_signal&quot; =&gt; 0.0
)
julia&gt; fs = AllocationOpt.allocatablesubgraphs(s, config)
FlexTable with 2 columns and 2 rows:
     signalledTokens  ipfsHash
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 1 â”‚ 20               Qmb
 2 â”‚ 5                Qmc</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L410-L437">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.allocate_action-Tuple{Val{:actionqueue}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.allocate_action-Tuple{Val{:actionqueue}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.allocate_action</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">allocate_action(::Val{:actionqueue}, a::FlexTable, t::FlexTable, config::AbstractDict)</code></pre><p>Create and push allocate actions to the action queue.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; a = flextable([
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)
        ])
julia&gt; t = flextable([
    Dict(&quot;amount&quot; =&gt; &quot;1&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qma&quot;),
    Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qmb&quot;),
])
julia&gt; config = Dict(
    &quot;indexer_url&quot; =&gt; &quot;http://localhost:18000&quot;
)
julia&gt; TheGraphData.client!(config[&quot;indexer_url&quot;])
julia&gt; AllocationOpt.allocate_action(Val(:actionqueue), a, t, Dict())
1-element Vector{Dict{String, Any}}:
 Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;priority&quot; =&gt; 0, &quot;status&quot; =&gt; AllocationOpt.queued, &quot;source&quot; =&gt; &quot;AllocationOpt&quot;, &quot;reason&quot; =&gt; &quot;Expected profit: 0&quot;, &quot;type&quot; =&gt; AllocationOpt.allocate, &quot;deploymentID&quot; =&gt; &quot;Qmb&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L477-L500">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.allocate_action-Tuple{Val{:none}, Any, Any, Any}" href="#AllocationOpt.allocate_action-Tuple{Val{:none}, Any, Any, Any}"><code>AllocationOpt.allocate_action</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">allocate_action(::Val{:none}, a, t, config)</code></pre><p>Do nothing.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; a = flextable([
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)
        ])
julia&gt; t = flextable([
            Dict(&quot;amount&quot; =&gt; &quot;1&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qma&quot;),
            Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qmb&quot;),
        ])
julia&gt; AllocationOpt.allocate_action(Val(:none), a, t, Dict())</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L222-L239">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.allocate_action-Tuple{Val{:rules}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.allocate_action-Tuple{Val{:rules}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.allocate_action</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">allocate_action(::Val{:rules}, a::FlexTable, t::FlexTable, config::AbstractDict)</code></pre><p>Print the rules that allocates to new subgraphs.</p><p>```julia julia&gt; using AllocationOpt julia&gt; using TheGraphData julia&gt; a = flextable([             Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)         ]) julia&gt; t = flextable([             Dict(&quot;amount&quot; =&gt; &quot;1&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qma&quot;),             Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qmb&quot;),         ]) julia&gt; AllocationOpt.allocate_action(Val(:rules), a, t, Dict()) graph indexer rules set Qmb decisionBasis always allocationAmount 2 1-element Vector{String}:  &quot;[0mgraph indexer rules set Qmb decisionBasis always allocationAmount 2&quot;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L311-L330">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.aquery-Tuple{AbstractString}" href="#AllocationOpt.aquery-Tuple{AbstractString}"><code>AllocationOpt.aquery</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">aquery(id::AbstractString)</code></pre><p>Return the components of a GraphQL query for active allocations of indexer <code>id</code>.</p><p>For use with the TheGraphData.jl package.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; id = &quot;0xa&quot;
julia&gt; value, args, fields = AllocationOpt.aquery(id)
(&quot;allocations&quot;, Dict{String, Union{Dict{String, String}, String}}(&quot;where&quot; =&gt; Dict(&quot;status&quot; =&gt; &quot;Active&quot;, &quot;indexer&quot; =&gt; &quot;0xa&quot;)), [&quot;allocatedTokens&quot;, &quot;id&quot;, &quot;subgraphDeployment{ipfsHash}&quot;])</code></pre><p><strong>Extended Help</strong></p><p>You can find TheGraphData.jl at https://github.com/semiotic-ai/TheGraphData.jl</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L51-L67">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.availablestake-Tuple{Val{:indexer}, Any}" href="#AllocationOpt.availablestake-Tuple{Val{:indexer}, Any}"><code>AllocationOpt.availablestake</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">available(::Val{:indexer}, x)</code></pre><p>The tokens available for the indexer to allocate in table <code>x</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(
        &quot;stakedTokens&quot; =&gt; 10,
        &quot;delegatedTokens&quot; =&gt; 20,
        &quot;lockedTokens&quot; =&gt; 5,
    ),
])
julia&gt; AllocationOpt.availablestake(Val(:indexer), x)
25.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L335-L353">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.bestprofitpernz-Union{Tuple{S}, Tuple{T}, Tuple{AbstractVector{T}, AbstractMatrix{S}}} where {T&lt;:Integer, S&lt;:Real}" href="#AllocationOpt.bestprofitpernz-Union{Tuple{S}, Tuple{T}, Tuple{AbstractVector{T}, AbstractMatrix{S}}} where {T&lt;:Integer, S&lt;:Real}"><code>AllocationOpt.bestprofitpernz</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">bestprofitpernz(ixs::AbstractVector{Integer}, profitmatrix::AbstractMatrix{Real})</code></pre><p>Compute the best profit amongst the given <code>ixs</code> given profit matrix <code>p</code></p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; ixs = Dict([1] =&gt; [1], [2] =&gt; [2])
julia&gt; profitmatrix = [[2.5 5.0]; [2.5 1.0]]
julia&gt; AllocationOpt.bestprofitpernz.(values(ixs), Ref(profitmatrix))
2-element Vector{NamedTuple{(:profit, :index), Tuple{Float64, Int64}}}:
 (profit = 5.0, index = 1)
 (profit = 6.0, index = 2)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L25-L39">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.blockissuance-Tuple{Val{:network}, Any}" href="#AllocationOpt.blockissuance-Tuple{Val{:network}, Any}"><code>AllocationOpt.blockissuance</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">blockissuance(::Val{:network}, x)</code></pre><p>The tokens issued per block.</p><p>```julia julia&gt; using AllocationOpt julia&gt; using TheGraphData julia&gt; n = flextable([     Dict(         &quot;id&quot; =&gt; 1,         &quot;totalSupply&quot; =&gt; 1,         &quot;networkGRTIssuance&quot; =&gt; 1,         &quot;epochLength&quot; =&gt; 28,         &quot;totalTokensSignalled&quot; =&gt; 2,         &quot;currentEpoch&quot; =&gt; 1,     ) ]) julia&gt; AllocationOpt.blockissuance(Val(:network), n) 1</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L46-L66">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.blocksperepoch-Tuple{Val{:network}, Any}" href="#AllocationOpt.blocksperepoch-Tuple{Val{:network}, Any}"><code>AllocationOpt.blocksperepoch</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">blocksperepoch(::Val{:network}, x)</code></pre><p>The number of blocks in each epoch.</p><p>```julia julia&gt; using AllocationOpt julia&gt; using TheGraphData julia&gt; n = flextable([     Dict(         &quot;id&quot; =&gt; 1,         &quot;totalSupply&quot; =&gt; 1,         &quot;networkGRTIssuance&quot; =&gt; 1,         &quot;epochLength&quot; =&gt; 28,         &quot;totalTokensSignalled&quot; =&gt; 2,         &quot;currentEpoch&quot; =&gt; 1,     ) ]) julia&gt; AllocationOpt.blocksperepoch(Val(:network), n) 28</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L69-L89">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.closeipfs-Tuple{Any, Any, Any}" href="#AllocationOpt.closeipfs-Tuple{Any, Any, Any}"><code>AllocationOpt.closeipfs</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">closeipfs(existingipfs, proposedipfs, frozenlist)</code></pre><p>Get the list of the ipfs hashes of allocations to close.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; AllocationOpt.closeipfs([&quot;Qma&quot;], [&quot;Qmb&quot;], String[])
1-element Vector{String}:
 &quot;Qma&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L348-L359">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.configuredefaults!-Tuple{AbstractDict}" href="#AllocationOpt.configuredefaults!-Tuple{AbstractDict}"><code>AllocationOpt.configuredefaults!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">configuredefaults!(config::AbstractDict)</code></pre><p>Set default values for the config dictionary if the value was not specified in the config file.</p><p><strong>Config Specification</strong></p><ul><li><code>id::String</code>: The ID of the indexer for whom we&#39;re optimising. No default value.</li><li><code>network_subgraph_endpoint::String</code>: The network subgraph endpoint to query.   By default, <code>&quot;https://api.thegraph.com/subgraphs/name/graphprotocol/graph-network-mainnet&quot;</code></li><li><code>writedir::String</code>: The directory to which to write the results of optimisation.   If don&#39;t specify <code>readdir</code>, <code>writedir</code> also specifies the path to which to save   the input data tables. By default, <code>&quot;.&quot;</code></li><li><code>readdir::Union{String, Nothing}</code>: The directory from which to read saved data tables.   This speeds up the process as we won&#39;t have to query the network subgraph for the   relevant data. If you don&#39;t specify <code>readdir</code>, we will query your specified   <code>network_subgraph_endpoint</code> for the data and write it to CSV files in <code>writedir</code>.   This way, you can use your previous <code>writedir</code> as your <code>readdir</code> in future runs.   By default, <code>nothing</code></li><li><code>whitelist::Vector{String}</code>: A list of subgraph IPFS hashes that you want to consider   as candidates to which to allocate. If you leave this empty, we&#39;ll assume all subgraphs   are in the whitelist. By default, <code>String[]</code></li><li><code>blacklist::Vector{String}</code>: A list of subgraph IPFS hashes that you do not want to   consider allocating to. For example, this list could include broken subgraphs or   subgraphs that you don&#39;t want to index. By default, <code>String[]</code></li><li><code>frozenlist::Vector{String}</code>: If you have open allocations that you don&#39;t want to change,   add the corresponding subgraph IPFS hashes to this list. By default, <code>String[]</code></li><li><code>pinnedlist::Vector{String}</code>: If you have subgraphs that you absolutely want to be   allocated to, even if only with a negligible amount of GRT, add it to this list.   By default, <code>String[]</code></li><li><code>allocation_lifetime::Integer</code>: The number of epochs for which you expect the allocations   the optimiser finds to be open. By default, <code>28</code></li><li><code>gas::Real</code>: The estimated gas cost in GRT to open/close allocations. By default, <code>100</code></li><li><code>min_signal::Real</code>: The minimum amount of signal in GRT that must be on a subgraph   in order for you to consider allocating to it. By default, <code>1000</code></li><li><code>max_allocations::Integer</code>: The maximum number of new allocations you&#39;d like the optimiser   to consider opening. By default, <code>10</code></li><li><code>num_reported_options::Integer</code>: The number of proposed allocation strategies to report.   For example, if you select <code>10</code> we&#39;d report best 10 allocation strategies ranked by   profit. By default, <code>1</code></li><li><code>verbose::Bool</code>: If true, the optimiser will print details about what it is doing to   stdout. By default, <code>false</code></li><li><code>execution_mode::String</code>: How the optimiser should execute the allocation strategies it   finds. Options are <code>&quot;none&quot;</code>, which won&#39;t do anything, <code>&quot;actionqueue&quot;</code>, which will   push actions to the action queue, and <code>&quot;rules&quot;</code>, which will generate indexing rules.   By default, <code>&quot;none&quot;</code></li><li><code>indexer_url::Union{String, Nothing}</code>: The URL of the indexer management server you want   to execute the allocation strategies on. If you specify <code>&quot;actionqueue&quot;</code>, you must also   specify <code>indexer_url</code>. By default, <code>nothing</code></li><li><code>opt_mode::String</code>: We support two optimisation modes. One is <code>&quot;fast&quot;</code>. This mode is   fast, but may not find the optimal allocation. This mode is also used to the top   <code>num_reported_options</code> allocation strategies. The other mode is <code>&quot;optimal&quot;</code>. This   mode is slower, but will find the optimal allocation. In general, we recommend   exploring config options using <code>&quot;fast&quot;</code> mode first, and then using <code>&quot;optimal&quot;</code>   mode to find the optimal allocation. By default, <code>&quot;fast&quot;</code></li></ul><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; config = Dict{String, Any}(&quot;id&quot; =&gt; &quot;0xa&quot;)
julia&gt; config = AllocationOpt.configuredefaults!(config)
Dict{String, Any} with 16 entries:
  &quot;execution_mode&quot;            =&gt; &quot;none&quot;
  &quot;readdir&quot;                   =&gt; nothing
  &quot;writedir&quot;                  =&gt; &quot;.&quot;
  &quot;num_reported_options&quot;      =&gt; 1
  &quot;id&quot;                        =&gt; &quot;0xa&quot;
  &quot;pinnedlist&quot;                =&gt; String[]
  &quot;indexer_url&quot;               =&gt; nothing
  &quot;gas&quot;                       =&gt; 100
  &quot;allocation_lifetime&quot;       =&gt; 28
  &quot;blacklist&quot;                 =&gt; String[]
  &quot;verbose&quot;                   =&gt; false
  &quot;min_signal&quot;                =&gt; 1000
  &quot;network_subgraph_endpoint&quot; =&gt; &quot;https://api.thegraph.com/subgraphs/name/graphprotocol/graph-network-mainnet&quot;
  &quot;whitelist&quot;                 =&gt; String[]
  â‹®                           =&gt; â‹®</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/configuration.jl#L4-L80">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.correcttypes!-NTuple{4, TypedTables.FlexTable}" href="#AllocationOpt.correcttypes!-NTuple{4, TypedTables.FlexTable}"><code>AllocationOpt.correcttypes!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">correcttypes!(i::FlexTable, a::FlexTable, s::FlexTable, n::FlexTable)</code></pre><p>Convert all tables to be in GRT.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; i = flextable([
    Dict(
        &quot;stakedTokens&quot; =&gt; &quot;1&quot;,
        &quot;delegatedTokens&quot; =&gt; &quot;0&quot;,
        &quot;id&quot; =&gt; &quot;0xa&quot;,
        &quot;lockedTokens&quot; =&gt; &quot;0&quot;,
    ),
])
julia&gt; s = flextable([
    Dict(
        &quot;stakedTokens&quot; =&gt; &quot;1&quot;,
        &quot;signalledTokens&quot; =&gt; &quot;0&quot;,
        &quot;ipfsHash&quot; =&gt; &quot;Qma&quot;,
    ),
])
julia&gt; a = flextable([
    Dict(
        &quot;allocatedTokens&quot; =&gt; &quot;1&quot;,
        &quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;,
    ),
])
julia&gt; n = flextable([
    Dict(
        &quot;id&quot; =&gt; 1,
        &quot;totalSupply&quot; =&gt; &quot;1&quot;,
        &quot;networkGRTIssuance&quot; =&gt; &quot;1&quot;,
        &quot;epochLength&quot; =&gt; 28,
        &quot;totalTokensSignalled&quot; =&gt; &quot;2&quot;,
        &quot;currentEpoch&quot; =&gt; 1,
    )
])
julia&gt; i, a, s, n = AllocationOpt.correcttypes!(i, a, s, n)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L360-L401">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.correcttypes!-Tuple{Val{:allocation}, TypedTables.FlexTable}" href="#AllocationOpt.correcttypes!-Tuple{Val{:allocation}, TypedTables.FlexTable}"><code>AllocationOpt.correcttypes!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">correcttypes!(::Val{:allocation}, a::FlexTable)</code></pre><p>Convert the string currency fields in the allocation table to be in GRT.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; a = flextable([
    Dict(
        &quot;allocatedTokens&quot; =&gt; &quot;1&quot;,
        &quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;,
    ),
])
julia&gt; AllocationOpt.correcttypes!(Val(:allocation), a)
FlexTable with 2 columns and 1 row:
     subgraphDeployment.ipfsHash  allocatedTokens
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 1 â”‚ Qma                          1.0e-18</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L302-L322">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.correcttypes!-Tuple{Val{:indexer}, TypedTables.FlexTable}" href="#AllocationOpt.correcttypes!-Tuple{Val{:indexer}, TypedTables.FlexTable}"><code>AllocationOpt.correcttypes!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">correcttypes!(::Val{:indexer}, i::FlexTable)</code></pre><p>Convert the string currency fields in the indexer table to be in GRT.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; i = flextable([
    Dict(
        &quot;stakedTokens&quot; =&gt; &quot;1&quot;,
        &quot;delegatedTokens&quot; =&gt; &quot;0&quot;,
        &quot;id&quot; =&gt; &quot;0xa&quot;,
        &quot;lockedTokens&quot; =&gt; &quot;0&quot;,
    ),
])
julia&gt; AllocationOpt.correcttypes!(Val(:indexer), i)
FlexTable with 4 columns and 1 row:
     stakedTokens  delegatedTokens  id   lockedTokens
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 1 â”‚ 1.0e-18       0.0              0xa  0.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L243-L265">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.correcttypes!-Tuple{Val{:network}, TypedTables.FlexTable}" href="#AllocationOpt.correcttypes!-Tuple{Val{:network}, TypedTables.FlexTable}"><code>AllocationOpt.correcttypes!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">correcttypes!(::Val{:network}, n::FlexTable)</code></pre><p>Convert the string currency fields in the network table to be in GRT.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; n = flextable([
    Dict(
        &quot;id&quot; =&gt; 1,
        &quot;totalSupply&quot; =&gt; &quot;1&quot;,
        &quot;networkGRTIssuance&quot; =&gt; &quot;1&quot;,
        &quot;epochLength&quot; =&gt; 28,
        &quot;totalTokensSignalled&quot; =&gt; &quot;2&quot;,
        &quot;currentEpoch&quot; =&gt; 1,
    )
])
julia&gt; AllocationOpt.correcttypes!(Val(:network), n)
FlexTable with 6 columns and 1 row:
     totalTokensSignalled  currentEpoch  totalSupply  id  networkGRTIssuance  epochLength
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 1 â”‚ 2.0e-18               1             1.0e-18      1   1.0e-18             28</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L328-L352">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.correcttypes!-Tuple{Val{:subgraph}, TypedTables.FlexTable}" href="#AllocationOpt.correcttypes!-Tuple{Val{:subgraph}, TypedTables.FlexTable}"><code>AllocationOpt.correcttypes!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">correcttypes!(::Val{:subgraph}, s::FlexTable)</code></pre><p>Convert the string currency fields in the subgraph table to be in GRT.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; s = flextable([
    Dict(
        &quot;stakedTokens&quot; =&gt; &quot;1&quot;,
        &quot;signalledTokens&quot; =&gt; &quot;0&quot;,
        &quot;ipfsHash&quot; =&gt; &quot;Qma&quot;,
        &quot;deniedAt&quot; =&gt; 0,
    ),
])
julia&gt; AllocationOpt.correcttypes!(Val(:subgraph), s)
FlexTable with 4 columns and 1 row:
     deniedAt  stakedTokens  signalledTokens  ipfsHash
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 1 â”‚ 0         1.0e-18       0.0              Qma</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L273-L295">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.currentepoch-Tuple{Val{:network}, Any}" href="#AllocationOpt.currentepoch-Tuple{Val{:network}, Any}"><code>AllocationOpt.currentepoch</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">currentepoch(::Val{:network}, x)</code></pre><p>The current epoch.</p><p>```julia julia&gt; using AllocationOpt julia&gt; using TheGraphData julia&gt; n = flextable([     Dict(         &quot;id&quot; =&gt; 1,         &quot;totalSupply&quot; =&gt; 1,         &quot;networkGRTIssuance&quot; =&gt; 1,         &quot;epochLength&quot; =&gt; 28,         &quot;totalTokensSignalled&quot; =&gt; 2,         &quot;currentEpoch&quot; =&gt; 1,     ) ]) julia&gt; AllocationOpt.currentepoch(Val(:network), n) 1</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L115-L135">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.delegation-Tuple{Val{:indexer}, Any}" href="#AllocationOpt.delegation-Tuple{Val{:indexer}, Any}"><code>AllocationOpt.delegation</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">delegation(::Val{:indexer}, x)</code></pre><p>The tokens delegated to the indexer in table <code>x</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(
        &quot;delegatedTokens&quot; =&gt; 10,
    ),
])
julia&gt; AllocationOpt.delegation(Val(:indexer), x)
10</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L297-L313">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.deniedat-Tuple{Val{:subgraph}, Any}" href="#AllocationOpt.deniedat-Tuple{Val{:subgraph}, Any}"><code>AllocationOpt.deniedat</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">deniedat(::Val{:subgraph}, x)</code></pre><p>If this value is non-zero, the subgraph doesn&#39;t receive indexing rewards.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(&quot;deniedAt&quot; =&gt; 10,),
    Dict(&quot;deniedAt&quot; =&gt; 0,),
])
julia&gt; AllocationOpt.deniedat(Val(:subgraph), x)
2-element view(transpose(lazystack(::Vector{Vector{Int64}})), :, 1) with eltype Int64:
 10
  0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L258-L275">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.deniedzeroixs-Tuple{TypedTables.FlexTable}" href="#AllocationOpt.deniedzeroixs-Tuple{TypedTables.FlexTable}"><code>AllocationOpt.deniedzeroixs</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">deniedzeroixs(s::FlexTable)</code></pre><p>Find the indices of subgraphs that have &quot;deniedAt&quot; equal to zero.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; s = flextable([
           Dict(&quot;ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;signalledTokens&quot; =&gt; 5.0, &quot;deniedAt&quot; =&gt; 0),
           Dict(&quot;ipfsHash&quot; =&gt; &quot;Qmb&quot;, &quot;signalledTokens&quot; =&gt; 10.0, &quot;deniedAt&quot; =&gt; 10),
           Dict(&quot;ipfsHash&quot; =&gt; &quot;Qmc&quot;, &quot;signalledTokens&quot; =&gt; 15.0, &quot;deniedAt&quot; =&gt; 0),
       ])
julia&gt; AllocationOpt.deniedzeroixs(s)
2-element Vector{Int64}:
 1
 3</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L604-L622">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.dual-Tuple{Any, Any, Any}" href="#AllocationOpt.dual-Tuple{Any, Any, Any}"><code>AllocationOpt.dual</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">dual(Î©, Ïˆ, Ïƒ)</code></pre><p>Analytic solution of the dual form of the optimisation problem given signals <code>Ïˆ</code>, allocation vector <code>Î©</code>, and stake <code>Ïƒ</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>You should probably not use this function directly. Use <a href="#AllocationOpt.optimizeanalytic-Tuple{Any, Any, Any}"><code>optimizeanalytic</code></a> instead.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L127-L135">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.execute-Union{Tuple{T}, Tuple{TypedTables.FlexTable, Integer, TypedTables.FlexTable, AbstractMatrix{T}, AbstractMatrix{T}, AbstractDict}} where T&lt;:Real" href="#AllocationOpt.execute-Union{Tuple{T}, Tuple{TypedTables.FlexTable, Integer, TypedTables.FlexTable, AbstractMatrix{T}, AbstractMatrix{T}, AbstractDict}} where T&lt;:Real"><code>AllocationOpt.execute</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">execute(
    a::FlexTable,
    ix::Integer,
    s::FlexTable,
    xs::AbstractMatrix{T},
    ps::AbstractMatrix{T},
    config::AbstractDict
) where {T&lt;:Real}</code></pre><p>Execute the actions picked by the optimiser.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; a = flextable([
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)
        ])
julia&gt; xs = [[2.5 5.0]; [2.5 0.0]]
julia&gt; ps = [[3.0 5.0]; [3.0 0.0]]
julia&gt; s = flextable([
            Dict(&quot;stakedTokens&quot; =&gt; &quot;1&quot;, &quot;signalledTokens&quot; =&gt; &quot;0&quot;, &quot;ipfsHash&quot; =&gt; &quot;Qma&quot;),
            Dict(&quot;stakedTokens&quot; =&gt; &quot;2&quot;, &quot;signalledTokens&quot; =&gt; &quot;0&quot;, &quot;ipfsHash&quot; =&gt; &quot;Qmb&quot;),
        ])
julia&gt; config = Dict(&quot;execution_mode&quot; =&gt; &quot;none&quot;)
julia&gt; ix = 1
julia&gt; AllocationOpt.execute(a, ix, s, xs, ps, config)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L527-L555">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.formatconfig!-Tuple{AbstractDict}" href="#AllocationOpt.formatconfig!-Tuple{AbstractDict}"><code>AllocationOpt.formatconfig!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">formatconfig!(config::AbstractDict)</code></pre><p>Given a <code>config</code>, reformat values that need to be standardised.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; config = Dict(&quot;id&quot; =&gt; &quot;0xA&quot;)
julia&gt; AllocationOpt.formatconfig!(config)
Dict{String, String} with 1 entry:
  &quot;id&quot; =&gt; &quot;0xa&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/configuration.jl#L106-L118">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.frozen-Tuple{TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.frozen-Tuple{TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.frozen</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">frozen(a::FlexTable, config::AbstractDict)</code></pre><p>The frozen stake of the indexer with allocations <code>a</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; a = flextable([
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;allocatedTokens&quot; =&gt; 5),
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qmb&quot;, &quot;allocatedTokens&quot; =&gt; 10),
       ])
julia&gt; config = Dict(&quot;frozenlist&quot; =&gt; [&quot;Qma&quot;, &quot;Qmb&quot;])
julia&gt; AllocationOpt.frozen(a, config)
15.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L359-L375">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.groupunique-Tuple{AbstractVector}" href="#AllocationOpt.groupunique-Tuple{AbstractVector}"><code>AllocationOpt.groupunique</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">groupunique(x::AbstractVector)</code></pre><p>Find the indices of each unique value in <code>x</code></p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; x = [1, 2, 1, 3, 2, 3]
julia&gt; AllocationOpt.groupunique(x)
Dict{Vector{Int64}, Vector{Int64}} with 3 entries:
  [3] =&gt; [4, 6]
  [1] =&gt; [1, 3]
  [2] =&gt; [2, 5]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L4-L18">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.id-Tuple{Val{:allocation}, Any}" href="#AllocationOpt.id-Tuple{Val{:allocation}, Any}"><code>AllocationOpt.id</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">id(::Val{:allocation}, x)</code></pre><p>Get the allocation id for each allocation in <code>x</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(
        &quot;id&quot; =&gt; &quot;0x1&quot;
    ),
])
julia&gt; AllocationOpt.id(Val(:allocation), x)
1-element view(lazystack(::Vector{Vector{String}}), 1, :) with eltype String:
 &quot;0x1&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L178-L195">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.indexingreward-NTuple{5, Real}" href="#AllocationOpt.indexingreward-NTuple{5, Real}"><code>AllocationOpt.indexingreward</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">indexingreward(x::Real, Î©::Real, Ïˆ::Real, Î¦::Real, Î¨::Real)</code></pre><p>The indexing rewards for the allocation scalar <code>x</code> given signals <code>Ïˆ</code>, the existing allocation on subgraphs <code>Î©</code>, token issuance <code>Î¦</code>, and total signal <code>Î¨</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; Ïˆ = 0.0
julia&gt; Î© = 1.0
julia&gt; Î¦ = 1.0
julia&gt; Î¨ = 2.0
julia&gt; x = 1.0
julia&gt; AllocationOpt.indexingreward(x, Î©, Ïˆ, Î¦, Î¨)
0.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L567-L583">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.indexingreward-Union{Tuple{I}, Tuple{T}, Tuple{AbstractArray{I}, AbstractVector{T}, AbstractVector{T}, AbstractVector{T}, Real, Real}} where {T&lt;:Real, I&lt;:Integer}" href="#AllocationOpt.indexingreward-Union{Tuple{I}, Tuple{T}, Tuple{AbstractArray{I}, AbstractVector{T}, AbstractVector{T}, AbstractVector{T}, Real, Real}} where {T&lt;:Real, I&lt;:Integer}"><code>AllocationOpt.indexingreward</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">indexingreward(
    ixs::AbstractArray{Integer},
    x::AbstractVector{Real},
    Î©::AbstractVector{Real},
    Ïˆ::AbstractVector{Real},
    Î¦::Real,
    Î¨::Real
)</code></pre><p>The indexing rewards for the allocation vector <code>x</code> given signals <code>Ïˆ</code>, the existing allocations on subgraphs <code>Î©</code>, token issuance <code>Î¦</code>, and total signal <code>Î¨</code>. Here <code>ixs</code> is a vector of indices <code>Î©</code>, and <code>Ïˆ</code>. <code>x</code> will be filtered by <code>SemioticOpt</code>, so we don&#39;t do this here.</p><p><code>julia julia&gt; using AllocationOpt julia&gt; ixs = Int32[2] julia&gt; Ïˆ = [0.0, 1.0] julia&gt; Î© = [1.0, 1.0] julia&gt; Î¦ = 1.0 julia&gt; Î¨ = 2.0 julia&gt; x = [0.0, 1.0] julia&gt; AllocationOpt.indexingreward(ixs, x, Î©, Ïˆ, Î¦, Î¨) 0.25</code>`</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L499-L526">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.indexingreward-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractVector{T}, AbstractVector{T}, Real, Real}} where T&lt;:Real" href="#AllocationOpt.indexingreward-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractVector{T}, AbstractVector{T}, Real, Real}} where T&lt;:Real"><code>AllocationOpt.indexingreward</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">indexingreward(
    x::AbstractVector{Real},
    Î©::AbstractVector{Real},
    Ïˆ::AbstractVector{Real},
    Î¦::Real,
    Î¨::Real
)</code></pre><p>The indexing rewards for the allocation vector <code>x</code> given signals <code>Ïˆ</code>, the existing allocations on subgraphs <code>Î©</code>, token issuance <code>Î¦</code>, and total signal <code>Î¨</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; Ïˆ = [0.0, 1.0]
julia&gt; Î© = [1.0, 1.0]
julia&gt; Î¦ = 1.0
julia&gt; Î¨ = 2.0
julia&gt; x = [0.0, 1.0]
julia&gt; AllocationOpt.indexingreward(x, Î©, Ïˆ, Î¦, Î¨)
0.25</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L538-L560">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.ipfshash-Tuple{Val{:allocation}, Any}" href="#AllocationOpt.ipfshash-Tuple{Val{:allocation}, Any}"><code>AllocationOpt.ipfshash</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">ipfshash(::Val{:allocation}, x)</code></pre><p>Get the ipfs hash of <code>x</code> when <code>x</code> is part of the allocation table.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(
        &quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;,
    ),
])
julia&gt; AllocationOpt.ipfshash(Val(:allocation), x)
1-element view(lazystack(::Vector{Vector{String}}), 1, :) with eltype String:
 &quot;Qma&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L138-L155">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.ipfshash-Tuple{Val{:subgraph}, Any}" href="#AllocationOpt.ipfshash-Tuple{Val{:subgraph}, Any}"><code>AllocationOpt.ipfshash</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">ipfshash(::Val{:subgraph}, x)</code></pre><p>Get the ipfs hash of <code>x</code> when <code>x</code> is part of the allocation table.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(
        &quot;ipfsHash&quot; =&gt; &quot;Qma&quot;,
    ),
])
julia&gt; AllocationOpt.ipfshash(Val(:subgraph), x)
1-element view(lazystack(::Vector{Vector{String}}), 1, :) with eltype String:
 &quot;Qma&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L198-L215">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.iquery-Tuple{AbstractString}" href="#AllocationOpt.iquery-Tuple{AbstractString}"><code>AllocationOpt.iquery</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">iquery(id::AbstractString)</code></pre><p>Return the components of a GraphQL query for the stake of indexer <code>id</code>.</p><p>For use with the TheGraphData.jl package.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; id = &quot;0xa&quot;
julia&gt; value, args, fields = AllocationOpt.iquery(id)
(&quot;indexer&quot;, Dict{String, Union{Int64, Dict{String, String}, String}}(&quot;id&quot; =&gt; &quot;0xa&quot;), [&quot;delegatedTokens&quot;, &quot;stakedTokens&quot;, &quot;lockedTokens&quot;])</code></pre><p><strong>Extended Help</strong></p><p>You can find TheGraphData.jl at https://github.com/semiotic-ai/TheGraphData.jl</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L27-L43">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.lipschitzconstant-Tuple{Any, Any}" href="#AllocationOpt.lipschitzconstant-Tuple{Any, Any}"><code>AllocationOpt.lipschitzconstant</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">lipschitzconstant(Ïˆ, Î©)</code></pre><p>The Lipschitz constant of the indexing reward function given signals <code>Ïˆ</code> and allocations <code>Î©</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; Ïˆ = [0.0, 1.0]
julia&gt; Î© = [1.0, 1.0]
julia&gt; AllocationOpt.lipschitzconstant(Ïˆ, Î©)
2.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L336-L349">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.locked-Tuple{Val{:indexer}, Any}" href="#AllocationOpt.locked-Tuple{Val{:indexer}, Any}"><code>AllocationOpt.locked</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">locked(::Val{:indexer}, x)</code></pre><p>The locked tokens of the indexer in table <code>x</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(
        &quot;lockedTokens&quot; =&gt; 10,
    ),
])
julia&gt; AllocationOpt.locked(Val(:indexer), x)
10</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L316-L332">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.newtokenissuance-Tuple{TypedTables.FlexTable, Dict}" href="#AllocationOpt.newtokenissuance-Tuple{TypedTables.FlexTable, Dict}"><code>AllocationOpt.newtokenissuance</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">newtokenissuance(n::FlexTable, config::Dict)</code></pre><p>How many new tokens are issued over the allocation lifetime given network parameters <code>n</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; n = flextable([
            Dict(
                &quot;id&quot; =&gt; 1,
                &quot;totalSupply&quot; =&gt; 1,
                &quot;networkGRTIssuance&quot; =&gt; 2,
                &quot;epochLength&quot; =&gt; 1,
                &quot;totalTokensSignalled&quot; =&gt; 2,
                &quot;currentEpoch&quot; =&gt; 1,
            )
        ])
julia&gt; config = Dict(&quot;allocation_lifetime&quot; =&gt; 1)
julia&gt; AllocationOpt.newtokenissuance(n, config)
1.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L467-L489">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.nonzero-Tuple{AbstractVector}" href="#AllocationOpt.nonzero-Tuple{AbstractVector}"><code>AllocationOpt.nonzero</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">nonzero(v::AbstractVector)</code></pre><p>Get the non-zero elements of vector <code>v</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; v = [0.0, 1.0]
julia&gt; AllocationOpt.nonzero(v)
1-element view(::Vector{Float64}, [2]) with eltype Float64:
 1.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L352-L364">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.nquery-Tuple{}" href="#AllocationOpt.nquery-Tuple{}"><code>AllocationOpt.nquery</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">nquery()</code></pre><p>Return the components of a GraphQL query for network parameters.</p><p>For use with the TheGraphData.jl package.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; value, args, fields = AllocationOpt.nquery()
(&quot;graphNetwork&quot;, Dict(&quot;id&quot; =&gt; 1), [&quot;id&quot;, &quot;totalSupply&quot;, &quot;networkGRTIssuance&quot;, &quot;epochLength&quot;, &quot;totalTokensSignalled&quot;, &quot;currentEpoch&quot;])</code></pre><p><strong>Extended Help</strong></p><p>You can find TheGraphData.jl at https://github.com/semiotic-ai/TheGraphData.jl</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L77-L92">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.optimize-Tuple{Any, Any, Any, Any, Any, Any, Any, Any, AbstractDict}" href="#AllocationOpt.optimize-Tuple{Any, Any, Any, Any, Any, Any, Any, Any, AbstractDict}"><code>AllocationOpt.optimize</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">optimize(Î©, Ïˆ, Ïƒ, K, Î¦, Î¨, g, rixs, config::AbstractDict)</code></pre><p>Find the optimal solution vector given allocations of other indexers <code>Î©</code>, signals <code>Ïˆ</code>, available stake <code>Ïƒ</code>, new tokens issued <code>Î¦</code>, total signal <code>Î¨</code>, and gas in grt <code>g</code>. <code>rixs</code> are the indices of subgraphs that are eligible to receive indexing rewards.</p><p>Dispatches to <a href="#AllocationOpt.optimize-Tuple{Any, Any, Any, Any, Any, Any, Any, Any, AbstractDict}"><code>optimize</code></a> with the <code>opt_mode</code> key.</p><p>If <code>opt_mode</code> is <code>fast</code>, then run projected gradient descent with GSSP and Halpern. If <code>opt_mode</code> is <code>optimal</code>, then run Pairwise Greedy Optimisation.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; config = Dict(&quot;opt_mode&quot; =&gt; &quot;fast&quot;)
julia&gt; rixs = [1, 2]
julia&gt; Î© = [1.0, 1.0]
julia&gt; Ïˆ = [10.0, 10.0]
julia&gt; Ïƒ = 5.0
julia&gt; K = 2
julia&gt; Î¦ = 1.0
julia&gt; Î¨ = 20.0
julia&gt; g = 0.01
julia&gt; xs, nonzeros, profits = AllocationOpt.optimize(Î©, Ïˆ, Ïƒ, K, Î¦, Î¨, g, rixs, config)
([5.0 2.5; 0.0 2.5], Int32[1, 2], [0.4066666666666667 0.34714285714285714; 0.0 0.34714285714285714])</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L147-L174">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.optimize-Tuple{Val{:fast}, Any, Any, Any, Any, Any, Any, Any, Any}" href="#AllocationOpt.optimize-Tuple{Val{:fast}, Any, Any, Any, Any, Any, Any, Any, Any}"><code>AllocationOpt.optimize</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">optimize(::Val{:fast}, Î©, Ïˆ, Ïƒ, K, Î¦, Î¨, g, rixs)</code></pre><p>Find the optimal vectors for k âˆˆ [1,<code>K</code>] given allocations of other indexers <code>Î©</code>, signals <code>Ïˆ</code>, available stake <code>Ïƒ</code>, new tokens issued <code>Î¦</code>, total signal <code>Î¨</code>, and gas in grt <code>g</code>. <code>rixs</code> are the indices of subgraphs that are eligible to receive indexing rewards.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; rixs = [1, 2]
julia&gt; Î© = [1.0, 1.0]
julia&gt; Ïˆ = [10.0, 10.0]
julia&gt; Ïƒ = 5.0
julia&gt; K = 2
julia&gt; Î¦ = 1.0
julia&gt; Î¨ = 20.0
julia&gt; g = 0.01
julia&gt; xs, nonzeros, profits = AllocationOpt.optimize(Val(:fast), Î©, Ïˆ, Ïƒ, K, Î¦, Î¨, g, rixs)
([5.0 2.5; 0.0 2.5], Int32[1, 2], [0.4066666666666667 0.34714285714285714; 0.0 0.34714285714285714])</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L179-L199">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.optimize-Tuple{Val{:optimal}, Any, Any, Any, Any, Any, Any, Any, Any}" href="#AllocationOpt.optimize-Tuple{Val{:optimal}, Any, Any, Any, Any, Any, Any, Any, Any}"><code>AllocationOpt.optimize</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">optimize(::Val{:optimal}, Î©, Ïˆ, Ïƒ, K, Î¦, Î¨, g, rixs)</code></pre><p>Find the optimal solution vector given allocations of other indexers <code>Î©</code>, signals <code>Ïˆ</code>, available stake <code>Ïƒ</code>, new tokens issued <code>Î¦</code>, total signal <code>Î¨</code>, and gas in grt <code>g</code>. <code>rixs</code> are the indices of subgraphs that are eligible to receive indexing rewards.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; rixs = [1, 2]
julia&gt; Î© = [1.0, 1.0]
julia&gt; Ïˆ = [10.0, 10.0]
julia&gt; Ïƒ = 5.0
julia&gt; K = 2
julia&gt; Î¦ = 1.0
julia&gt; Î¨ = 20.0
julia&gt; g = 0.01
julia&gt; xs, nonzeros, profits = AllocationOpt.optimize(
           Val(:optimal), Î©, Ïˆ, Ïƒ, K, Î¦, Î¨, g, rixs
       )
([2.5; 2.5;;], Int32[2], [0.34714285714285714; 0.34714285714285714;;])</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L266-L289">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.optimizeanalytic-Tuple{Any, Any, Any}" href="#AllocationOpt.optimizeanalytic-Tuple{Any, Any, Any}"><code>AllocationOpt.optimizeanalytic</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">optimizeanalytic(Î©, Ïˆ, Ïƒ)</code></pre><p>Optimise analytically over existing allocation vector <code>Î©</code>, signals <code>Ïˆ</code>, and stake <code>Ïƒ</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; Î© = [1.0, 7.0]
julia&gt; Ïˆ = [10.0, 5.0]
julia&gt; Ïƒ = 5.0
julia&gt; AllocationOpt.optimizeanalytic(Î©, Ïˆ, Ïƒ)
2-element Vector{Float64}:
 3.5283092056122474
 1.4716907943877526</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L90-L105">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.optimizek-NTuple{7, Any}" href="#AllocationOpt.optimizek-NTuple{7, Any}"><code>AllocationOpt.optimizek</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">optimizek(Î©, Ïˆ, Ïƒ, k, Î¦, Î¨)</code></pre><p>Find the optimal <code>k</code> sparse vector given allocations of other indexers <code>Î©</code>, signals <code>Ïˆ</code>, available stake <code>Ïƒ</code>, new tokens issued <code>Î¦</code>, and total signal <code>Î¨</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; xopt = [2.5, 2.5]
julia&gt; Î© = [1.0, 1.0]
julia&gt; Ïˆ = [10.0, 10.0]
julia&gt; Ïƒ = 5.0
julia&gt; k = 1
julia&gt; Î¦ = 1.0
julia&gt; Î¨ = 20.0
julia&gt; AllocationOpt.optimizek(xopt, Î©, Ïˆ, Ïƒ, k, Î¦, Î¨)
2-element Vector{Float64}:
 5.0
 0.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L229-L249">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.pinned-Tuple{TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.pinned-Tuple{TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.pinned</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">pinned(config::AbstractDict)</code></pre><p>The pinned vector of the indexer.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; s = flextable([
    Dict(&quot;ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;signalledTokens&quot; =&gt; 5.0),
    Dict(&quot;ipfsHash&quot; =&gt; &quot;Qmb&quot;, &quot;signalledTokens&quot; =&gt; 10.0),
    Dict(&quot;ipfsHash&quot; =&gt; &quot;Qmc&quot;, &quot;signalledTokens&quot; =&gt; 15.0),
])
julia&gt; config = Dict(&quot;pinnedlist&quot; =&gt; [&quot;Qma&quot;, &quot;Qmb&quot;])
julia&gt; AllocationOpt.pinned(s, config)
3-element Vector{Float64}:
 0.1
 0.1
 0.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L383-L402">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.primal-Tuple{Any, Any, Any}" href="#AllocationOpt.primal-Tuple{Any, Any, Any}"><code>AllocationOpt.primal</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">primal(Î©, Ïˆ, Î½)</code></pre><p>Analytic solution of the primal form of the optimisation problem given signals <code>Ïˆ</code>, allocations <code>Î©</code>, and a dual solution vector <code>Î½</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>You should probably not use this function directly. Use <a href="#AllocationOpt.optimizeanalytic-Tuple{Any, Any, Any}"><code>optimizeanalytic</code></a> instead.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L116-L124">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.profit-Tuple{Real, Real}" href="#AllocationOpt.profit-Tuple{Real, Real}"><code>AllocationOpt.profit</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">profit(r::Real, g::Real)</code></pre><p>Compute the profit for one allocation with reward <code>r</code> and gas cost <code>g</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; r = 10
julia&gt; g = 1
julia&gt; AllocationOpt.profit(r, g)
9</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L589-L601">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.read-Tuple{AbstractDict{String, Any}}" href="#AllocationOpt.read-Tuple{AbstractDict{String, Any}}"><code>AllocationOpt.read</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">read(config::AbstractDict)</code></pre><p>Given a <code>config</code>, read the data in as flextables.</p><p>If you have specified a &quot;readdir&quot; in the config, this will read from CSV files in that directory. Otherwise, this will query the specified <code>&quot;network_subgraph_endpoint&quot;</code></p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; config = Dict(&quot;verbose&quot; =&gt; false, &quot;readdir&quot; =&gt; &quot;mydatadir&quot;)
julia&gt; i, a, s, n = AllocationOpt.read(config)  # Read data from CSVs</code></pre><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; config = Dict(
    &quot;verbose&quot; =&gt; false,
    &quot;network_subgraph_endpoint&quot; =&gt; &quot;https://api.thegraph.com/subgraphs/name/graphprotocol/graph-network-mainnet&quot;,
    &quot;readdir&quot; =&gt; nothing,
)
julia&gt; i, a, s, n = AllocationOpt.read(config)  # Query GQL endpoint</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L185-L208">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.read-Tuple{AbstractString, AbstractDict}" href="#AllocationOpt.read-Tuple{AbstractString, AbstractDict}"><code>AllocationOpt.read</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">read(f::AbstractString, config::AbstractDict)</code></pre><p>Read the CSV files from <code>f</code> and return the tables from those files.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; i, a, s, n = AllocationOpt.read(&quot;myreaddir&quot;, Dict(&quot;verbose&quot; =&gt; true))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L127-L136">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.read-Tuple{Nothing, AbstractDict{String, Any}}" href="#AllocationOpt.read-Tuple{Nothing, AbstractDict{String, Any}}"><code>AllocationOpt.read</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">read(::Nothing, config::AbstractDict)</code></pre><p>Query the required data from the provided endpoint in the <code>config</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; config = Dict(
            &quot;verbose&quot; =&gt; true,
            &quot;network_subgraph_endpoint&quot; =&gt; &quot;https://api.thegraph.com/subgraphs/name/graphprotocol/graph-network-mainnet&quot;,
        )
julia&gt; i, a, s, n = AllocationOpt.read(nothing, config)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L153-L166">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.readconfig-Tuple{AbstractString}" href="#AllocationOpt.readconfig-Tuple{AbstractString}"><code>AllocationOpt.readconfig</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">readconfig(p::AbstractString)</code></pre><p>Read the config file from path <code>p</code>. The config file must be specifed as a TOML.</p><p>See <a href="#AllocationOpt.configuredefaults!-Tuple{AbstractDict}"><code>configuredefaults!</code></a> to see which fields you should specify in the config.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; path = &quot;myconfig.toml&quot;
julia&gt; config = AllocationOpt.readconfig(path)
Dict{String, Any} with 13 entries:
  &quot;execution_mode&quot;       =&gt; &quot;none&quot;
  &quot;writedir&quot;             =&gt; &quot;data&quot;
  &quot;num_reported_options&quot; =&gt; 2
  &quot;id&quot;                   =&gt; &quot;0xd75c4dbcb215a6cf9097cfbcc70aab2596b96a9c&quot;
  &quot;pinnedlist&quot;           =&gt; Union{}[]
  &quot;gas&quot;                  =&gt; 100
  &quot;allocation_lifetime&quot;  =&gt; 28
  &quot;blacklist&quot;            =&gt; Union{}[]
  &quot;verbose&quot;              =&gt; true
  &quot;min_signal&quot;           =&gt; 1000
  &quot;whitelist&quot;            =&gt; Union{}[]
  &quot;max_allocations&quot;      =&gt; 5
  &quot;frozenlist&quot;           =&gt; Union{}[]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/configuration.jl#L124-L150">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.reallocate_action-Tuple{Val{:actionqueue}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.reallocate_action-Tuple{Val{:actionqueue}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.reallocate_action</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">reallocate_action(::Val{:actionqueue}, a::FlexTable, t::FlexTable, config::AbstractDict)</code></pre><p>Create and push reallocate actions to the action queue.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; a = flextable([
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)
        ])
julia&gt; t = flextable([
    Dict(&quot;amount&quot; =&gt; &quot;1&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qma&quot;),
    Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qmb&quot;),
])
julia&gt; config = Dict(&quot;indexer_url&quot; =&gt; &quot;http://localhost:18000&quot;)
julia&gt; TheGraphData.client!(config[&quot;indexer_url&quot;])
julia&gt; AllocationOpt.reallocate_action(Val(:actionqueue), a, t, config)
1-element Vector{Dict{String, Any}}:
 Dict(&quot;amount&quot; =&gt; &quot;1&quot;, &quot;priority&quot; =&gt; 0, &quot;status&quot; =&gt; AllocationOpt.queued, &quot;allocationID&quot; =&gt; &quot;0xa&quot;, &quot;source&quot; =&gt; &quot;AllocationOpt&quot;, &quot;reason&quot; =&gt; &quot;Expected profit: 0&quot;, &quot;type&quot; =&gt; AllocationOpt.reallocate, &quot;deploymentID&quot; =&gt; &quot;Qma&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L428-L449">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.reallocate_action-Tuple{Val{:none}, Any, Any, Any}" href="#AllocationOpt.reallocate_action-Tuple{Val{:none}, Any, Any, Any}"><code>AllocationOpt.reallocate_action</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">reallocate_action(::Val{:none}, a, t, config)</code></pre><p>Do nothing.</p><p>```julia julia&gt; using AllocationOpt julia&gt; using TheGraphData julia&gt; a = flextable([             Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)         ]) julia&gt; t = flextable([             Dict(&quot;amount&quot; =&gt; &quot;1&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qma&quot;),             Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qmb&quot;),         ]) julia&gt; AllocationOpt.reallocate_action(Val(:none), a, t, Dict())</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L203-L219">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.reallocate_action-Tuple{Val{:rules}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.reallocate_action-Tuple{Val{:rules}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.reallocate_action</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">reallocate_action(::Val{:rules}, a::FlexTable, t::FlexTable, config::AbstractDict)</code></pre><p>Print a rule that reallocates the old allocation with a new allocation amount</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; a = flextable([
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)
        ])
julia&gt; t = flextable([
    Dict(&quot;amount&quot; =&gt; &quot;1&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qma&quot;),
    Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qmb&quot;),
])
julia&gt; AllocationOpt.reallocate_action(Val(:rules), a, t, Dict())
graph indexer rules stop Qma
Check allocation status being closed before submitting: graph indexer rules set Qma decisionBasis always allocationAmount 1
1-element Vector{String}:
 &quot;[0mgraph indexer rules stop Qm&quot; â‹¯ 122 bytes â‹¯ &quot;asis always allocationAmount 1&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L272-L293">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.reportingtable-Union{Tuple{T}, Tuple{TypedTables.FlexTable, AbstractMatrix{T}, AbstractMatrix{T}, Integer}} where T&lt;:Real" href="#AllocationOpt.reportingtable-Union{Tuple{T}, Tuple{TypedTables.FlexTable, AbstractMatrix{T}, AbstractMatrix{T}, Integer}} where T&lt;:Real"><code>AllocationOpt.reportingtable</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">reportingtable(
    s::FlexTable, xs::AbstractMatrix{Real}, ps::AbstractMatrix{Real}, i::Integer
)</code></pre><p>Construct a table for the strategy mapping the ipfshash, allocation amount, and profit</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; s = flextable([
        Dict(&quot;stakedTokens&quot; =&gt; &quot;1&quot;, &quot;signalledTokens&quot; =&gt; &quot;2&quot;, &quot;ipfsHash&quot; =&gt; &quot;Qma&quot;),
        Dict(&quot;stakedTokens&quot; =&gt; &quot;2&quot;, &quot;signalledTokens&quot; =&gt; &quot;1&quot;, &quot;ipfsHash&quot; =&gt; &quot;Qmb&quot;),
    ])
julia&gt; xs = [[2.5 5.0]; [2.5 0.0]]
julia&gt; ps = [[3.0 5.0]; [3.0 0.0]]
julia&gt; i = 1
julia&gt; AllocationOpt.reportingtable(s, xs, ps, i)
FlexTable with 3 columns and 2 rows:
     ipfshash  amount  profit
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 1 â”‚ Qma       2.5     3.0
 2 â”‚ Qmb       2.5     3.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L68-L91">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.savenames-Tuple{AbstractString}" href="#AllocationOpt.savenames-Tuple{AbstractString}"><code>AllocationOpt.savenames</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">savenames(p::AbstractString)</code></pre><p>Return a generator of the generic names of the CSV files containing the data with the path specified by <code>p</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; path = &quot;mypath&quot;
julia&gt; paths = AllocationOpt.savenames(path)
Base.Generator{NTuple{4, String}, AllocationOpt.var&quot;#1#2&quot;{String}}(AllocationOpt.var&quot;#1#2&quot;{String}(&quot;mypath&quot;), (&quot;indexer.csv&quot;, &quot;allocation.csv&quot;, &quot;subgraph.csv&quot;, &quot;network.csv&quot;))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L107-L119">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.signal-Tuple{Val{:network}, Any}" href="#AllocationOpt.signal-Tuple{Val{:network}, Any}"><code>AllocationOpt.signal</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">signal(::Val{:network}, x)</code></pre><p>The total signal in the network</p><p>```julia julia&gt; using AllocationOpt julia&gt; using TheGraphData julia&gt; n = flextable([     Dict(         &quot;id&quot; =&gt; 1,         &quot;totalSupply&quot; =&gt; 1,         &quot;networkGRTIssuance&quot; =&gt; 1,         &quot;epochLength&quot; =&gt; 28,         &quot;totalTokensSignalled&quot; =&gt; 2,         &quot;currentEpoch&quot; =&gt; 1,     ) ]) julia&gt; AllocationOpt.signal(Val(:network), n) 2</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L92-L112">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.signal-Tuple{Val{:subgraph}, Any}" href="#AllocationOpt.signal-Tuple{Val{:subgraph}, Any}"><code>AllocationOpt.signal</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">signal(::Val{:subgraph}, x)</code></pre><p>The tokens signalled on the subgraphs in table <code>x</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(&quot;signalledTokens&quot; =&gt; 10,),
    Dict(&quot;signalledTokens&quot; =&gt; 5,),
])
julia&gt; AllocationOpt.signal(Val(:subgraph), x)
2-element view(transpose(lazystack(::Vector{Vector{Int64}})), :, 1) with eltype Int64:
 10
  5</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L238-L255">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.sortprofits!-Union{Tuple{AbstractVector{N}}, Tuple{N}} where N&lt;:NamedTuple" href="#AllocationOpt.sortprofits!-Union{Tuple{AbstractVector{N}}, Tuple{N}} where N&lt;:NamedTuple"><code>AllocationOpt.sortprofits!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">sortprofits!(NamedTuple{Tuple{Float64, Int64}})</code></pre><p>Sort the nonzero best profits from highest to lowest</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; popts = [
        (; :profit =&gt; 5.0, :index =&gt; 2),
        (; :profit =&gt; 6.0, :index =&gt; 1)
    ]
julia&gt; popts = AllocationOpt.sortprofits!(popts)
2-element Vector{NamedTuple{(:profit, :index), Tuple{Float64, Int64}}}:
 (profit = 6.0, index = 1)
 (profit = 5.0, index = 2)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L48-L63">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.squery-Tuple{}" href="#AllocationOpt.squery-Tuple{}"><code>AllocationOpt.squery</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">squery()</code></pre><p>Return the components of a GraphQL query for subgraphs.</p><p>For use with the TheGraphData.jl package.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; value, args, fields = AllocationOpt.squery()
(&quot;subgraphDeployments&quot;, Dict{String, Union{Dict{String, String}, String}}(), [&quot;ipfsHash&quot;, &quot;signalledTokens&quot;, &quot;stakedTokens&quot;])</code></pre><p><strong>Extended Help</strong></p><p>You can find TheGraphData.jl at https://github.com/semiotic-ai/TheGraphData.jl</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L4-L19">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.stake-Tuple{Val{:allocation}, Any}" href="#AllocationOpt.stake-Tuple{Val{:allocation}, Any}"><code>AllocationOpt.stake</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">stake(::Val{:allocation}, x)</code></pre><p>Get the allocated tokens for each allocation in <code>x</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(
        &quot;allocatedTokens&quot; =&gt; 1,
    ),
])
julia&gt; AllocationOpt.stake(Val(:allocation), x)
1-element view(transpose(lazystack(::Vector{Vector{Int64}})), :, 1) with eltype Int64:
 1</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L158-L175">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.stake-Tuple{Val{:indexer}, Any}" href="#AllocationOpt.stake-Tuple{Val{:indexer}, Any}"><code>AllocationOpt.stake</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">stake(::Val{:indexer}, x)</code></pre><p>The tokens staked by the indexer in table <code>x</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(
        &quot;stakedTokens&quot; =&gt; 10,
    ),
])
julia&gt; AllocationOpt.stake(Val(:indexer), x)
10</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L278-L294">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.stake-Tuple{Val{:subgraph}, Any}" href="#AllocationOpt.stake-Tuple{Val{:subgraph}, Any}"><code>AllocationOpt.stake</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">stake(::Val{:subgraph}, x)</code></pre><p>The tokens staked on the subgraphs in table <code>x</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; x = flextable([
    Dict(&quot;stakedTokens&quot; =&gt; 10,),
    Dict(&quot;stakedTokens&quot; =&gt; 5,),
])
julia&gt; AllocationOpt.stake(Val(:subgraph), x)
2-element view(transpose(lazystack(::Vector{Vector{Int64}})), :, 1) with eltype Int64:
 10
  5</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L218-L235">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.strategydict-Union{Tuple{I}, Tuple{T}, Tuple{NamedTuple, AbstractMatrix{T}, AbstractVector{I}, TypedTables.FlexTable, AbstractMatrix{T}}} where {T&lt;:Real, I&lt;:Integer}" href="#AllocationOpt.strategydict-Union{Tuple{I}, Tuple{T}, Tuple{NamedTuple, AbstractMatrix{T}, AbstractVector{I}, TypedTables.FlexTable, AbstractMatrix{T}}} where {T&lt;:Real, I&lt;:Integer}"><code>AllocationOpt.strategydict</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">strategydict(
    p::NamedTuple,
    xs::AbstractMatrix{Real},
    nonzeros::AbstractVector{Integer},
    fs::FlexTable,
    profitmatrix::AbstractMatrix{Real}
)</code></pre><p>For a profit, index pair <code>p</code>, generate the nested dictionary representing the data to convert to a JSON string. <code>xs</code> is the allocation strategy matrix, <code>nonzeros</code> are the number of nonzeros in each allocation strategy, <code>fs</code> is a table containing subgraph ipfshashes, and the <code>profitmatrix</code> is a matrix containing profit for each allocation in <code>xs</code></p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; popts = [
        (; :profit =&gt; 6.0, :index =&gt; 1),
        (; :profit =&gt; 5.0, :index =&gt; 2)
    ]
julia&gt; xs = [[2.5 5.0]; [2.5 0.0]]
julia&gt; profits = [[3.0 5.0]; [3.0 0.0]]
julia&gt; nonzeros = [2, 1]
julia&gt; fs = flextable([
        Dict(&quot;stakedTokens&quot; =&gt; &quot;1&quot;, &quot;signalledTokens&quot; =&gt; &quot;0&quot;, &quot;ipfsHash&quot; =&gt; &quot;Qma&quot;),
        Dict(&quot;stakedTokens&quot; =&gt; &quot;2&quot;, &quot;signalledTokens&quot; =&gt; &quot;0&quot;, &quot;ipfsHash&quot; =&gt; &quot;Qmb&quot;),
    ])
julia&gt; AllocationOpt.strategydict.(popts, Ref(xs), Ref(nonzeros), Ref(fs), Ref(profits))
2-element Vector{Dict{String, Any}}:
 Dict(&quot;num_allocations&quot; =&gt; 2, &quot;profit&quot; =&gt; 6.0, &quot;allocations&quot; =&gt; Dict{String, Any}[Dict(&quot;allocationAmount&quot; =&gt; &quot;2.5&quot;, &quot;profit&quot; =&gt; 3.0, &quot;deploymentID&quot; =&gt; &quot;Qma&quot;), Dict(&quot;allocationAmount&quot; =&gt; &quot;2.5&quot;, &quot;profit&quot; =&gt; 3.0, &quot;deploymentID&quot; =&gt; &quot;Qmb&quot;)])
 Dict(&quot;num_allocations&quot; =&gt; 1, &quot;profit&quot; =&gt; 5.0, &quot;allocations&quot; =&gt; Dict{String, Any}[Dict(&quot;allocationAmount&quot; =&gt; &quot;5&quot;, &quot;profit&quot; =&gt; 5.0, &quot;deploymentID&quot; =&gt; &quot;Qma&quot;)])</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L104-L137">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.subtractindexer!-Tuple{TypedTables.FlexTable, TypedTables.FlexTable}" href="#AllocationOpt.subtractindexer!-Tuple{TypedTables.FlexTable, TypedTables.FlexTable}"><code>AllocationOpt.subtractindexer!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">subtractindexer!(a::FlexTable, s::FlexTable)</code></pre><p>Subtract the indexer&#39;s allocated tokens from the total allocated tokens on each subgraph.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; s = flextable([
            Dict(&quot;ipfsHash&quot; =&gt; &quot;Qmb&quot;, &quot;stakedTokens&quot; =&gt; 20),
            Dict(&quot;ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;stakedTokens&quot; =&gt; 10),
            Dict(&quot;ipfsHash&quot; =&gt; &quot;Qmc&quot;, &quot;stakedTokens&quot; =&gt; 5),
        ])
julia&gt; a = flextable([
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;allocatedTokens&quot; =&gt; 5, &quot;id&quot; =&gt; &quot;0xa&quot;),
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qmb&quot;, &quot;allocatedTokens&quot; =&gt; 10, &quot;id&quot; =&gt; &quot;0xb&quot;),
        ])
julia&gt; a, s = AllocationOpt.subtractindexer!(a, s)
(NamedTuple[(var&quot;subgraphDeployment.ipfsHash&quot; = &quot;Qma&quot;, allocatedTokens = 5, id = &quot;0xa&quot;), (var&quot;subgraphDeployment.ipfsHash&quot; = &quot;Qmb&quot;, allocatedTokens = 10, id = &quot;0xb&quot;)], NamedTuple[(stakedTokens = 5.0, ipfsHash = &quot;Qma&quot;), (stakedTokens = 10, ipfsHash = &quot;Qmb&quot;), (stakedTokens = 5, ipfsHash = &quot;Qmc&quot;)])</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L410-L430">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.togrt-Tuple{AbstractString}" href="#AllocationOpt.togrt-Tuple{AbstractString}"><code>AllocationOpt.togrt</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">togrt(x::AbstractString)</code></pre><p>Convert <code>x</code> to GRT.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This function is meant to be used with freshly queried data, so it operates on strings.</p></div></div><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; AllocationOpt.togrt(&quot;1&quot;)
1.0e-18</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L7-L20">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.totalsupply-Tuple{Val{:network}, Any}" href="#AllocationOpt.totalsupply-Tuple{Val{:network}, Any}"><code>AllocationOpt.totalsupply</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">totalsupply(::Val{:network}, x)</code></pre><p>The total GRT supply.</p><p>```julia julia&gt; using AllocationOpt julia&gt; using TheGraphData julia&gt; n = flextable([     Dict(         &quot;id&quot; =&gt; 1,         &quot;totalSupply&quot; =&gt; 1,         &quot;networkGRTIssuance&quot; =&gt; 1,         &quot;epochLength&quot; =&gt; 28,         &quot;totalTokensSignalled&quot; =&gt; 2,         &quot;currentEpoch&quot; =&gt; 1,     ) ]) julia&gt; AllocationOpt.totalsupply(Val(:network), n) 1</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/domain.jl#L23-L43">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.unallocate_action-Tuple{Val{:actionqueue}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.unallocate_action-Tuple{Val{:actionqueue}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.unallocate_action</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">unallocate_action(::Val{:actionqueue}, a::FlexTable, t::FlexTable, config::AbstractDict)</code></pre><p>Create and push the unallocate actions to the action queue.</p><p>```julia julia&gt; using AllocationOpt julia&gt; using TheGraphData julia&gt; a = flextable([             Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)         ]) julia&gt; t = flextable([             Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qmb&quot;),         ]) julia&gt; config = Dict(     &quot;frozenlist&quot; =&gt; [],     &quot;indexer<em>url&quot; =&gt; &quot;http://localhost:18000&quot; ) julia&gt; TheGraphData.client!(config[&quot;indexer</em>url&quot;]) julia&gt; AllocationOpt.unallocate_action(Val(:actionqueue), a, t, config) 1-element Vector{Dict{String, Any}}:  Dict(&quot;priority&quot; =&gt; 0, &quot;status&quot; =&gt; AllocationOpt.queued, &quot;allocationID&quot; =&gt; &quot;0xa&quot;, &quot;source&quot; =&gt; &quot;AllocationOpt&quot;, &quot;reason&quot; =&gt; &quot;AllocationOpt&quot;, &quot;type&quot; =&gt; AllocationOpt.unallocate, &quot;deploymentID&quot; =&gt; &quot;Qma&quot;)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L380-L402">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.unallocate_action-Tuple{Val{:none}, Any, Any, Any}" href="#AllocationOpt.unallocate_action-Tuple{Val{:none}, Any, Any, Any}"><code>AllocationOpt.unallocate_action</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">unallocate_action(::Val{:none}, a, t, config)</code></pre><p>Do nothing.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; a = flextable([
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)
        ])
julia&gt; t = flextable([
            Dict(&quot;amount&quot; =&gt; &quot;1&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qma&quot;),
            Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qmb&quot;),
        ])
julia&gt; AllocationOpt.unallocate_action(Val(:none), a, t, Dict())</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L184-L200">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.unallocate_action-Tuple{Val{:rules}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.unallocate_action-Tuple{Val{:rules}, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.unallocate_action</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">unallocate_action(::Val{:rules}, a::FlexTable, t::FlexTable, config::AbstractDict)</code></pre><p>Print a rule that stops old allocations that the optimiser has not chosen and that aren&#39;t frozen.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; a = flextable([
            Dict(&quot;subgraphDeployment.ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;id&quot; =&gt; &quot;0xa&quot;)
        ])
julia&gt; t = flextable([
            Dict(&quot;amount&quot; =&gt; &quot;2&quot;, &quot;profit&quot; =&gt; &quot;0&quot;, &quot;ipfshash&quot; =&gt; &quot;Qmb&quot;),
        ])
julia&gt; AllocationOpt.unallocate_action(Val(:rules), a, t, Dict(&quot;frozenlist&quot; =&gt; []))
graph indexer rules stop Qma
1-element Vector{String}:
 &quot;[0mgraph indexer rules stop Qma&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L242-L261">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.write-Tuple{TypedTables.FlexTable, TypedTables.FlexTable, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}" href="#AllocationOpt.write-Tuple{TypedTables.FlexTable, TypedTables.FlexTable, TypedTables.FlexTable, TypedTables.FlexTable, AbstractDict}"><code>AllocationOpt.write</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">write(i::FlexTable, a::FlexTable, s::FlexTable, n::FlexTable, config::AbstractDict)</code></pre><p>Write the tables to the <code>writedir</code> specified in the <code>config</code>.</p><pre><code class="language-julia hljs">julia&gt; using AllocationOpt
julia&gt; using TheGraphData
julia&gt; config = Dict(&quot;verbose&quot; =&gt; true, &quot;writedir&quot; =&gt; &quot;datadir&quot;)
julia&gt; t = flextable([
            Dict(&quot;ipfsHash&quot; =&gt; &quot;Qma&quot;, &quot;signalledTokens&quot; =&gt; &quot;1&quot;),
            Dict(&quot;ipfsHash&quot; =&gt; &quot;Qmb&quot;, &quot;signalledTokens&quot; =&gt; &quot;2&quot;),
        ])
julia&gt; i, a, s, n = repeat([t,], 4)
juila&gt; AllocationOpt.write(i, a, s, n, config)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/data.jl#L215-L232">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AllocationOpt.writejson-Tuple{AbstractString, AbstractDict}" href="#AllocationOpt.writejson-Tuple{AbstractString, AbstractDict}"><code>AllocationOpt.writejson</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function writejson(results::AbstractString, config::AbstractDict)</code></pre><p>Write the optimized results to the <code>writedir</code> specified in the <code>config</code>.</p><pre><code class="language-julia hljs">julia&gt; Using AllocationOpt
julia&gt; results = &quot;{&quot;strategies&quot;:[{&quot;num_allocations&quot;:2,&quot;profit&quot;:6.0,&quot;allocations&quot;:[{&quot;allocationAmount&quot;:2.5,&quot;profit&quot;:3.0,&quot;deploymentID&quot;:&quot;Qma&quot;},{&quot;allocationAmount&quot;:2.5,&quot;profit&quot;:3.0,&quot;deploymentID&quot;:&quot;Qmb&quot;}]},{&quot;num_allocations&quot;:1,&quot;profit&quot;:5.0,&quot;allocations&quot;:[{&quot;allocationAmount&quot;:5.0,&quot;profit&quot;:5.0,&quot;deploymentID&quot;:&quot;Qma&quot;}]}]}&quot;
julia&gt; config = Dict{&quot;writedir&quot; =&gt; &quot;.&quot;}
julia&gt; AllocationOpt.writejson(results, config)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/reporting.jl#L164-L175">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SemioticOpt.iteration-Tuple{Function, AllocationOpt.AnalyticOpt}" href="#SemioticOpt.iteration-Tuple{Function, AllocationOpt.AnalyticOpt}"><code>SemioticOpt.iteration</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">iteration(f::Function, a::AnalyticOpt)</code></pre><p>Perform the analytic optimisation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L74-L78">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SemioticOpt.x!-Tuple{AllocationOpt.AnalyticOpt, Any}" href="#SemioticOpt.x!-Tuple{AllocationOpt.AnalyticOpt, Any}"><code>SemioticOpt.x!</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">x!(a::AnalyticOpt, v)</code></pre><p>In-place setting of <code>a.x</code> to <code>v</code></p><p>See <a href="#SemioticOpt.x-Tuple{AllocationOpt.AnalyticOpt}"><code>SemioticOpt.x</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L61-L67">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SemioticOpt.x-Tuple{AllocationOpt.AnalyticOpt}" href="#SemioticOpt.x-Tuple{AllocationOpt.AnalyticOpt}"><code>SemioticOpt.x</code></a> â€” <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">x(a::AnalyticOpt)</code></pre><p>Return the current best guess for the solution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/graphprotocol/allocation-optimizer/blob/219d4e0930705e28e241e4d2e71169a0838dbb5e/src/opt.jl#L55-L59">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../output/">Â« Understanding The Output</a><a class="docs-footer-nextpage" href="../bugs/">Reporting Bugs Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 27 April 2023 23:11">Thursday 27 April 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
